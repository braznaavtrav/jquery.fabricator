/*!
 * jQuery Fabricator v0.1.0
 * Copyright 2014 Travis McKinney (braznaavtrav)
 * Licensed under MIT (https://github.com/braznaavtrav/jquery.fabricator/blob/master/LICENSE)
 */
!function(a){function b(b,c){this.el=b,this.$el=a(b),this.options=a.extend({},f,c),this._defaults=f,this._name=e,this._data={},this.init()}function c(a,b){this.x=a,this.y=b}function d(){this.points=arguments}var e="fabricator",f={shape:"triangle",size:50};d.prototype.componentToHex=function(a){var b=a.toString(16);return 1==b.length?"0"+b:b},d.prototype.rgbToHex=function(a,b,c){return"#"+this.componentToHex(a)+this.componentToHex(b)+this.componentToHex(c)},d.prototype.setColor=function(a){for(var b,c=0,d=0,e=this.points.length-1;e>=0;e--)c+=this.points[e].x,d+=this.points[e].y;c/=this.points.length,d/=this.points.length,b=a.getImageData(c,d,1,1).data,this.hexColor=this.rgbToHex(b[0],b[1],b[2])},d.prototype.draw=function(a){var b=this;a.fillStyle=b.hexColor,a.beginPath(),a.moveTo(b.points[0].x,b.points[0].y);for(var c=1;c<b.points.length;c++)a.lineTo(b.points[c].x,b.points[c].y);a.closePath(),a.fill()},b.prototype={init:function(){this.swapImgWithCanvas()&&(this.setUpPoints(),this.drawShapes())},swapImgWithCanvas:function(){var b=this,c=b.$el.width(),d=b.$el.height();return b.$el.is("img")?(b.$canvas=a("<canvas />"),b.$canvas.width(c).height(d),b.$canvas[0].width=c,b.$canvas[0].height=d,b.$el.after(b.$canvas),b.$el.hide(),b.context=b.$canvas[0].getContext("2d"),b.context.drawImage(b.el,0,0,c,d),!0):(a.error("Element used must be an <img>."),!1)},setUpPoints:function(){var b=this;switch(b._data.points=[],b._data.shapes=[],b.options.shape){case"triangle":b.makeTriangles();break;case"square":b.makeSquares();break;case"bucky":b.makeTriangles(),b.makeBuckies();break;default:a.error("Invalid shape option.")}},makeSquares:function(){for(var a,b,e=this,f=e.options.size,g=e.$canvas.width(),h=e.$canvas.height(),i=0,j=0;g+f>j;j+=f){e._data.points[i]=[];for(var k=0;h+f>k;k+=f)a=new c(j,k),e._data.points[i].push(a);i+=1}for(var l=0,m=e._data.points.length;m>l;l++)for(var j=0;j<e._data.points[l].length;j++)e._data.points[l][j+1]&&e._data.points[l+1]&&(b=new d(e._data.points[l][j],e._data.points[l][j+1],e._data.points[l+1][j+1],e._data.points[l+1][j]),b.setColor(e.context),e._data.shapes.push(b))},makeTriangles:function(){for(var a,b,e,f,g=this,h=g.options.size,i=g.$canvas.width(),j=g.$canvas.height(),k=0,l=h/2,m=Math.sqrt(3)*h/2,n=0;i+h>n;n+=h){g._data.points[k]=[],e=k%2===0,b=0;for(var o=0;j+h>o;o+=m)f=b%2===0,a=f?new c(n+l,o):new c(n,o),g._data.points[k].push(a),b+=1;k+=1}for(var p=0,q=g._data.points.length;q>p;p++)for(var n=0;n<g._data.points[p].length;n++)g._data.points[p][n+1]&&g._data.points[p+1]&&(n%2===0?(triangle1=new d(g._data.points[p][n],g._data.points[p+1][n+1],g._data.points[p][n+1]),triangle2=new d(g._data.points[p][n],g._data.points[p+1][n],g._data.points[p+1][n+1])):(triangle1=new d(g._data.points[p][n],g._data.points[p+1][n],g._data.points[p][n+1]),triangle2=new d(g._data.points[p][n+1],g._data.points[p+1][n],g._data.points[p+1][n+1])),triangle1.setColor(g.context),triangle2.setColor(g.context),g._data.shapes.push(triangle1,triangle2))},getCenterPoint:function(a){for(var b=0,d=0,e=a.points.length-1;e>=0;e--)b+=a.points[e].x,d+=a.points[e].y;return b/=a.points.length,d/=a.points.length,new c(b,d)},makeBuckies:function(){for(var a,b,c,e,f,g=this,h=[],i=g._data.shapes.length-1;i>=0;i--)b=g._data.shapes[i],a=g.getCenterPoint(b),c=new d(a,b.points[0],b.points[1]),e=new d(a,b.points[1],b.points[2]),f=new d(a,b.points[2],b.points[0]),c.setColor(g.context),e.setColor(g.context),f.setColor(g.context),h.push(c,e,f);g._data.shapes=h},drawShapes:function(){for(var a=this,b=a._data.shapes.length-1;b>=0;b--)a._data.shapes[b].draw(a.context)}},a.fn[e]=function(c){return this.each(function(){a.data(this,"plugin_"+e)||a.data(this,"plugin_"+e,new b(this,c))})}}(jQuery,window,document);